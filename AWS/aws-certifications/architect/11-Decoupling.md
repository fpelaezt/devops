## Amazon Simple Queue Service (SQS)

* Buffer between receivers and processers
* Allows decouple services/infrastructure
* System must be IDEMPOTENT, don't fail if a message is proccesed more than once
* At-least once delivery
* Can use both cloud and On-Premises instances
* Types
  * Standard Queues
  * Unlimited throughput
  * FIFO Queues
  * FIFO is not guarantee in an standard Queue, a FIFO queue must be used
  * FIFO queue doesn't allow duplicate message in a 5-min deduplication interval
  * FIFO has an extra charge
  * Throughput of 300 transactions per Second (TPS)
  * Not available in every region
* If order is important, a sequence must be inserted in the data
* Message Lifecycle
  * Component A sends message A to the queue
  * Message A is distributed across SQS servers
  * Message A is retrieved from Component B, remains in queue, not deliver to anyone before timer of Visibility Timeout expires
  * Component B deletes message A from the queue to avoid being delivered after Visibility Timeout expires
* Visibility Timeout (hide message after retrieved)
  * Default 30 seconds
  * Maximum up to 12 hours
* Delay Queues (hide message after queue)
  * Allow to postpone message delivery
  * Message is invisible until delay period [0sec - 900sec(15min)]
  * A normal queue can be converted into a delay queue
* Message
  * Up to 256KB
  * Message ID + Body
  * Body: name/value pairs. Unstructured/Uninterpreted content
  * Up to 120k messages "in flight"
  * A message is "in flight", when is neither delay nor visibility timeout
  * Encryption at rest not enabled by default
* Message Retention
  * Minumum: 1 minute
  * Default: 4 days*
  * Maximun: 14 days
* Throughput
  * Request-Response around 20ms per thread
* Identifiers
  * Message ID: Unique identifier. Up to string(100)
  * Receipt Handler: It's included in response after message retrieval. Up to string(1024)
  * Handler: To delete a message, component needs to use the handler, not the Message ID
  * Queue URL: name + other components
* Attributes
  * Up to 10 (Name-Type-Value)
  * Metadata as Timestamp, signatures, identifiers, etc.
* Long Polling
  * Client can set a WaitTimeSeconds in ReceiveMessage to wait X seconds for a new message
  * This avoid constantly checking the queue.
  * From 1 up to 20 seconds
  * Not enable by default
* Queue Depth
  * Can trigger autoscaling
* DeadLettersQueue
  * Queue used by other queues to send unsucessfully processed messages
* Access Control
  * IAM roles can be used but they are difficult to maintain
  * Better use SQS Access Control: Queue Policies in JSON format. Allows grant permision to others AWS accounts
* DeleteMessageBatch for reducing costs
* Commands
  * CreateQueue, ListQueues, DeleteQueue, SendMessage, SendMessageBatch, ReceiveMessage, DeleteMessage, DeleteMessageBatch, PurgeQueue
  * ChangeMessageVisibility, ChangeMessageVisibilityBatch, SetQueueAttributes, GetQueueAttributes, GetQueueUrl
  * ListDeadLettersSourceQueues, AddPermission, RemovePermission
* Batches can be used to Asynchronous implementations
* Batch operations cost the same as other requests
* If not used, AWS can delete a queue after 30 days without notification
* Billing
  * Calculated per request + data transfer

## Amazon Simple Workflow Service (SWF)

* Allow coordinates tasks for an specific work
* AWS Step Function: Similiar but simpler solution
* Manages dependencies, scheduling and concurrency
* Implements workers to perform tasks. Workers run on EC2 instances or in customer premises
* SWF: assign, monitor progress and maintain state
* Workflows
  * Tasks: Activities
  * Domain: scope of AWS resources. Resources in different domain can't cooperate. Related workflows
  * History: record of changes (state, completed, timeouts, signals)
  * Actors: programmatic features (starters, deciders, activities). Can be programmed in any language
    * Starters: Initiate workflow (eg:. place order)
    * Deciders: Coordinate tasks, schedule activities, close workflow
    * Activity Worker: process that performs activities. Polls AWS SWF for appropiated activity type. After completion return status
* Tasks Types
  * Activity Tasks: tells to an Activity Worker (with the information needed) to perform its function (eg:. charged credicard)
  * AWS Lambda Tasks: Similar to an Activity Tasks but executing AWS Lambda function
  * Decision Tasks: tells to a Decider about the state of the workflow. View of entire workflow execution history
* Tasks Lists: Way to organized tasks, similiar to a queue (dynamic)
* Long Polling
  * Decider or Activity Worker periodically initiates communication to SWF notifying its availability to perform a tasks
  * In this way Deciders or Activity Workers manage their own capacity
  * Maximum 20 seconds
* Object Identifiers
  * Workflow type: Domain, Name, Version. RegisterWorkflowType
  * Activity type: Domain, Name, Version. RegisterActivityType
  * Decision/Activity task: Identify by a task Token. Autogenerated by Amazon SWF. Return after PollForDecisionTask/PollForActivityTask
  * Execution: Domain, Workflow ID, run ID. StartWorkflowExecution
* Lifecycle
  * After Open can be closed as Completed, Canceled, Failed, TimeOut

## Amazon Simple Notification Service (SNS)

* Push notification of Mobile and Enterprise messages
* Types of endpoint: Email, Email-JSON, SMS, SQS, HTTP/S, AWS Lambda, Kinesis Data Firehose
* Maximum message size: 256KB
* Publish-Subscribe (pub-sub). Producers-Consumers
* Asynchronous communication from producers sendig a message to a topic
* If a message was sent can't be recalled
* DLQ Support for messages that fail to be delivered, except HTTP(S)
* Retries is support only for HTTP(S)
* Encryption in transit by default
* Encryption in at-rest is optional
* Support resource (topic) policies
* Topic
  * Logical access point/communication channel
  * Contain list of subscribers and methods
  * Names are limited to 256 characters
  * After sending a mesage to a topic, it's automatically forwarded to subscribers
  * A topic is configured by policies. Define which publishers/subscribers can communicate via which technology
  * Has a unique name and endpoint
  * A delete topic is available for reuse between 30-60 seconds after deletion. Depends on the number of subscribers
* Common Scenarios
  * Fanout
    * SNS mesage is sent to a topic and then replicated and pushed to mutiple: SQS - HTTP Endpoints - Email Addresses
    * Allows parallel asynchronous processing
    * Eg:. Product order: Process - Analytic
  * Application and System Alert: SMS/Email notifications
  * Push Email and Text Messaging: (eg:. news headlines)
  * Mobile Push Notifications: (eg:. available updates)

## AWS API Gateway

* Fully managed for publishing API
* Can be protected by WAF
* Stop Abuse (prevent DDoS attacks and set client limits)
* Uses cloudfront to improve response time
* Act as a AWS Service proxy
* Stages: Similar to tags / variables
* CORS: Cross Origin Resource Sharing
* Swagger: Import
* API Caching: Reduce latency (Not in the free tier)
* Throttling limit request, if exceeded generates error 429 (too many requests)
* /ping /sping reserved paths for health checks
* Create --> Deploy