# Ultimate AWS Certified Developer Associate 2019 - Summary

- [Ultimate AWS Certified Developer Associate 2019 - Summary](#ultimate-aws-certified-developer-associate-2019---summary)
  - [EC2](#ec2)
  - [RDS](#rds)
  - [S3](#s3)
  - [SDK](#sdk)
  - [Elastic Beanstalk](#elastic-beanstalk)
  - [CICD](#cicd)
  - [CodeCommit](#codecommit)
  - [CodePipeline](#codepipeline)
  - [CodeBuild](#codebuild)
  - [CodeDeploy](#codedeploy)
  - [CloudFormation](#cloudformation)
  - [Monitoring](#monitoring)
    - [AWS CloudWatch](#aws-cloudwatch)
    - [AWS X-Ray](#aws-x-ray)
    - [AWS CloudTrail](#aws-cloudtrail)
  - [AWS Integration & Messaging](#aws-integration--messaging)
    - [SQS](#sqs)
    - [SNS](#sns)
    - [AWS Kinesis](#aws-kinesis)
  - [AWS Lambda](#aws-lambda)
  - [DynamoDB](#dynamodb)
  - [API Gateway](#api-gateway)
  - [AWS Cognito](#aws-cognito)
  - [SAM (Serverless Application Model)](#sam-serverless-application-model)
  - [AWS Security](#aws-security)
  - [Other AWS Services](#other-aws-services)
    - [AWS CloudFront](#aws-cloudfront)
    - [AWS Step Functions](#aws-step-functions)
    - [AWS Simple Workflow Service (SWF)](#aws-simple-workflow-service-swf)
    - [AWS ECS (Elastic Container Service)](#aws-ecs-elastic-container-service)
    - [AWS Databases](#aws-databases)
    - [AWS CodeStart](#aws-codestart)
    - [AWS QuickSight](#aws-quicksight)
    - [AWS Config](#aws-config)

## EC2

- Pricing review: [Amazon EC2 On-Demand](https://aws.amazon.com/es/ec2/pricing/on-demand/)
- User Data: Accept bash scripts
- [Amazon Instance types](https://aws.amazon.com/es/ec2/instance-types/)
- [Amazon Instances review](https://ec2instances.info/)
- Instance Meta-Data: http://169.254.169.254/latest/meta-data/
- [Monthly Calculator](https://calculator.s3.amazonaws.com/index.html)
- AWS Inspector: Check EC2 vulnerabilities
- [FAQ](https://aws.amazon.com/ec2/faqs/)

## RDS

- Enforce SSL on RDS:
  - PostgreSQL: rds.force_ssl=1 in the AWS RDS Console (Parameter Groups)
  - MySQL: Within the DB: GRANT USAGE ON *.* TO 'mysqluser'@'%' REQUIRE SSL;
- Microsoft SQL Server: supports Transparent Data Encryption (TDE)
- Used when complex joins are needed
- Use Endpoint got from DescribeBDInstances API to connect
- Use General, Error and Slow query logs to debug issues
- [FAQ](https://aws.amazon.com/rds/faqs/)

## S3

- Encryption
  - SSE-S3 Encryption
    - Must set header: "x-amz-server-side-encryption":"AES-256"
    - S3 Managed Data Key (Managed by AWS)
  - SSE-KMS Encryption
    - Must set header: "x-amz-server-side-encryption":"aws-kms"
    - KMS Customer Master Key (Managed by the User)
  - SSE-C
    - Must use https
    - Encryption key must be provided in the HTTP headers
    - Client Side Data Key
    - Client-provider Data Key
    - User manages Data Key and Master Key
- CORS
  - Cross Origin Resource Sharing
- MFA
  - "aws-MultiFactorAuthPresent":"false" with a Deny Policy
- Delete Policy
  - Default is Delete
  - Ensure Bucket is empty
- Limits
  - Bucket: unlimited
  - File: 5TB
  - Use a random prefix to increse transactions per seconds
    - examplebucket/232a-2019-10-16/photo1.jgp
- Use AWS S3 Inventory to look for files with millions of versions generating HTTPS 503 error
- Provides 3500 PUT / 5500 GET per sec per prefix
- [FAQ](https://aws.amazon.com/s3/faqs/)

## SDK

- Exponential Backoff: After an API failure, the SDK retries waiting an exponential curve
- [Boto3 Documentation](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/index.html)

## Elastic Beanstalk

- Supports: Java SE, Java+Tomcat, PHP, Node.js, Python, Ruby, Go, Docker
- Deployments Modes
  - Single Instance: Dev, 1 AVZ, 1 Elastic IP, 1 WebApp Server
  - High Availability: Prod, Multiple AVZ, Load Balancer, ASG
- Deployments Options
  - All at once: fastest, downtime, no additional cost
  - Rolling: few instances at a time (called bucket), less capacity, run both versions, no additional cost
  - Rolling with additional batches: spins up new instances, run both versions, additional cost, full capacity all time
  - Immutable: spins up new instances in a new ASG, only one version, double capacity for a short time
  - Blue/Green: Manual intervention needed, similar to Immutable, Route S3 to weighted traffic
    - Create new environment with new app version and swap URL
- Code:
  - Must be in Zip or WAR
  - Up to 512MB
  - Can contain parameters (.ebextensions/) .config in YAML/JSON format in root
  - List of packages names in YAML/JSON to be installed
  - Files to install in the .ebextensions in your Application Source Bundle
  - Can modify default setting by option_settings
  - Use cron.yaml to perform periodic processes
- EB cli:
  - eb [create | status | health | events | logs | open | deploy | config | terminate]
- Relies on CloudFormation
- Modify EC Type using Launch Configuraton or Environment manifest in root
- Optimization: Package dependencies into source code to avoid EC2 to resolve them
- 1 environment runs 1 app version (Upload app version to environment)
- Use version lifecycle to avoid reaching the version limit
- Use Packer to create your own customized machine images
- Use "Create Snapshot" to retain database after termination
- [FAQ](https://aws.amazon.com/elasticbeanstalk/faqs/)

## CICD

- CodeCommit, CodePipeline, CodeBuild, CodeDeploy
- CodeBuild/CodePipeline = Jenkins
- Steps
  - Code: CodeCommit & GitHub
  - Build + Test: CodeBuild & Jenkins CI
  - Deploy + Provision: ElasticBeanstalk & CodeDeploy or * CloudFormation
  - Orchrestrate: CodePipeline

## CodeCommit

- GIT
- Integrated with Jenkins / CodeBuild
- Authentication
  - HTTPS Git credentials (AWS CLI Authentication helper)
  - Access Key
  - SSH Keys
  - MFA
- Encryption
  - Repositories are encrypted at rest using KMS
  - Encrypted in transit (only HTTPS or SSH)
  - Cross Account Access
    - IAM Role and use AWS STS (with AssumeRole API)
- Notification
  - AWS SNS /  Lambda
    - Deletion branches, Push into master, notify external build
    - Trigger lambda to perform codebase analysis
  - CloudWatch Event Rules
    - Trigger for pull request updates
    - Commit comments events
    - Goes into an SNS topic
- Billing: Pay USD$1 per user
- [FAQ](https://aws.amazon.com/codecommit/faqs/)

## CodePipeline

- Add manual approval
- Each stage create Artifacts
- Each stage contains a set of actions
- Changes are recorded into AWS CloudWatch Events (can trigger SNS)
- IAM Service Role must have appropriate permissions
- Define input/output in Data Nodes
- Multiaccount access
  - Create a Customer Master Key in KMS
  - Set policy and role to enable Cross-Account access
- [FAQ](https://aws.amazon.com/codepipeline/faqs/)

## CodeBuild

- Fully managed service
- Pay for usage
- Leverages Docker
- Security
  - Uses KMS to encrypt artifacts
  - Uses IAM to build
  - Uses VPC to network (with vpc-specific config in project)
  - Uses CloudTrail for API logging
- Components
  - Project: Define how AWS runs a build
  - Environment: OS + Language + Tools
  - Specs: buildspec.yml contains Build commands
- Output logs to S3 and CloudWatch
- CodeBuild Statistics to see metrics
- Uses CloudWatch Alarms to detect failed builds and trigger notifications
- Can use CloudWatch Events / AWS Lambda
- Can trigger SNS Notifications
- Code must be in the same region, othewise you get "The bucket specific endpoint not exist"
- Support: Java, Ruby, Python, Go, Node.js, Android, .NET Core, PHP, Docker (extend environment)
- Flow:
  - Source Code (buildspec.yml) + Build Docker Image (AWS or Custom)
  - CodeBuild Container + Optional S3 Cache Bucket
  - S3 Bucket Artifacts + Logs (CloudWatch - S3)
- Troubleshoot
  - Run CodeBuild on your laptop using Docker and [CodeBuild Agent](https://docs.aws.amazon.com/codebuild/latest/userguide/use-codebuild-agent.html)
- buildspec.yml
  - Must be in the root folder
  - Define environment variables (plaintext or Secure secrets with SSM Parameter store)
  - Phases
    - Install: dependencies
    - Pre-Build: final commands
    - Build
    - Post Build
- Commands
  - create-project
  - update-project
  - start-build
  - batch-get-builds
  - Use AWS-CLI the buildspecOverride property to set a new buildspec.yml
- [FAQ](https://aws.amazon.com/codebuild/faqs/)

## CodeDeploy

- Use to Deploy app into many EC2 or On Premise
- Support AWS Lambda deployments
- Not managed by Elastic Beanstalk
- Use a codedeploy-agent service on the servers
- Sends appspec.yml
- Code is pulled from GitHub or S3
- Server follow the instructions
- Servers are group by a deployment group (dev/test/prod)
- More powerfull than Elastic Beanstalk
- Support any application
- Support Blue/Green deployment on EC2 servers
- Don't provision resources
- Deployment parameters
  - Revision
  - Deployment group
  - Deployment configuration (optional)
- Components
  - Application: unique name
  - Compute platform: EC2/On-Premise or Lambda
  - Deployment configuration: Rules for success/failure (eg:.min healthy server/lambda traffic)
  - Deployment group: group of tagged instances
  - Deployment type: In-place or Blue/Green
  - IAM instances profile: Permission for EC2 to pull from repository
  - Application Revision: Code + appspec.yml
  - Service Role: Role for CodeDeploy to perform actions
  - Target Revision: Application version
- appspec.yml
  - Must be in the root folder
  - For Lambda: Need to specify the version and function as validation tests
  - Sections
    - File Section: How to source and copy from repository
    - Hooks: Instructions to deploy
      - Have timeouts
      - Order (Deployment 132Lifecycle events)
        - ApplicationStop
        - DownloadBundle
        - BeforeInstall
        - Install
        - AfterInstall
        - ApplicationStart
        - __ValidateService__
- Deployment Config In-Place
  - One a time
  - Half at a time
  - All at once
  - Custom: min healthy host = 75%
- Deployment Config  for Lambda
  - Canary
  - Linear
  - All at once
- Failures
  - Instances stay in "failed state"
  - New deployments will first be deployed to "failed state" instances
  - Rollback: re-deploy old deployment or enable automated rollback
  - If rollback fails when files not found, add them manually or create a new app revision
- Deployment targets
  - Set of tagged EC2 instances
  - Directly to an ASG even for new instances
  - Mix (Tag/ASG)
- [FAQ](https://aws.amazon.com/codedeploy/faqs/)

## CloudFormation

- Infrastructure as code
- Separation of concern
  - VPN stacks
  - Network stacks
  - App stacks
- Concepts
  - StackSets: to work with multiple AWS accounts
  - ChangeSets: Update stack
  - Nested Stacks: separation of concern
- To update Re-upload the new version
- Deploy
  - Manual: Edit using CloudFormation Designer or by console
  - Automatic: Edit YAML file and CLI
- Blocks
  - Resources (Mandatory)
  - Parameters: dynamic inputs (Up to 60)
  - Mappings: static variables
  - Outputs (Up to 60)
  - Conditionals
  - Metadata
- Helpers
  - References
  - Functions
    - Use cfn-init to install software (AWS::CloudFormation::Init)
- Resources
  - AWS componentes
  - [224 types of resources](https://docs.aws.amazon.com/es_es/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html)
  - Form: :aws-product-name::data-type-name
  - Don't support dynamic amount of resources
- Parameters
  - Use for things that can change in the future
  - Types: String | Number | CommaDelimitedList | List(Number) | AWS Parameter
  - Constraints: Min | Max | Defaults | AllowedValues
  - Reference: Fn::Ref or !Ref
  - Pseudo parameters: AccountId, StackName, StackId, Region, NoValue, NotificationARNs
- Mappings
  - Fixed variables
  - Eg:. RegionMap AZ use specific AMI
  - Access Mapping value: Fn::FindInMap or !FindInMap [MapName, TopLevelKey, SecondLevelKey]
  - eg:. !FinInMap [RegionMap, !REf "AWS::Region", 32]
- Output
  - They can be used to export to other CloudFormation templates
  - Fn::ImportValue or !ImportValue to reuse an output
  - An stack with refence outputs used by other stack can't be deleted
  - Names must be unique in the Region
- Conditions
  - Control creation of resources or outputs
  - !And, !Equals, !If, !Not, !Or
- Intrinsic Functions
  - Ref
    - Parameters: Return the value
    - Resources: Return the physical ID
  - GetAtt
    - Allows to get additional values, not just the name
  - FindInMap
  - ImportValue
  - Join: Join values
    - !Join[":",[a,b,c]]
  - Sub: Substitute
    - !Sub
      - String
      - {Var1Name: Var1Value, Var2Name: Var2Value}
  - Conditions
- Rollback
  - Default: everything rolls back (gets deleted). Can be disabled
  - If stack update fails, it rolls back to the previous state. Can be disabled
- [FAQ](https://aws.amazon.com/cloudformation/faqs/)

## Monitoring

### AWS CloudWatch

- Metric: Collect and track
  - Variable (CPUUtilization, NetworkIn, etc)
  - Belong to namespaces
  - Dimensions is an attribute of a metric (instance id, environment, etc)
  - Up to 10 Dimensions per metric
  - Have timestamps
  - Can create dashboards
  - Aggregation: To consolidate from different location or random spread in time
  - EC2
    - Default: every 5 minutes
    - Detailed monitoring: every minute
    - To have EC2 Memory have to use a Custom Metric
  - Custom Metrics
    - Standard: 1 minute
    - High Resolution: 1 second - higher cost (APICall StorageResolution)
    - Use API __PutMetricData__ to send a custom metric
    - Use exponential back off
- Logs
  - Collect and analyze
  - Send to S3 for archival
  - Send to ElasticSearch for analytics
  - Storage architecture
    - Log group --> Log stream
  - Log expiration policy
  - To send logs, make sure IAM permissions are correct
  - Encryption can be set to logs at rest using KMS at Group Level
  - Policy expiration should be set at Group Level
- Events
  - Send notifications
  - Schedule or Event Pattern
  - Creates an small JSON with information about the event
- Alarms
  - React in real-time
  - Options: sampling, %, max, min, etc
  - Status
    - OK
    - INSUFFICIENT_DATA
    - ALARM
  - Properties
    - Evaluation Period
    - Datapoint to Alarm
    - Period
      - High resolution period to trigger [10sec -30sec]
- [FAQ](https://aws.amazon.com/cloudwatch/faqs/)

### AWS X-Ray

- Troubleshoot performances (bottlenecks)
- Tracing microservices and dependencies
- Review behaviors
- Identify affected users
- Compatible
  - Lambda, Beanstalk, ECS, ECL, API Gateway, EC2, OnPremise
- Parameter
  - _X_AMZN_TRACE_ID
  - _AWS_XRAY_CONTEXT_MISSING_
  - _AWS_XRAY_DAEMON_ADDRESS_
- Leverages on Tracing
  - Annotation can be added to traces to provide extra-info
- Scope
  - Every request
  - Sample request (% or Rate per Minute)
- Security
  - IAM for authorization
  - KMS for encryption at rest
- To Enable on EC2
  - Code (JAVA, Python, Go, Node.js, .NET) must import X-Ray SDK
    - Capture Call to AWS services, HTTPS/HTTPS, Database Calls, SQS
  - Install X-Ray deamon or enable X-Ray AWS Integration
  - Low level IDP packet interceptor
  - Each app must have the IAM rights to write data to X-Ray
- To Enable on Lambda
  - Uses an IAM Role with policy AWSX-RayWriteOnlyAccess
- Enable on Elastic Beanstalk
  - Create an xray-deamon.config in the .ebextensions folder
- Sample
  - 1 req/sec & 5% of additional req per host
  - Reservoir Rate + Fixe Rate%[(Total Request - Reservoir Rate)]
- [FAQ](https://aws.amazon.com/xray/faqs/)

### AWS CloudTrail

- Audit API calls per Region
- If a resource is deleted, look into CloudTrail first
- [FAQ](https://aws.amazon.com/cloudtrail/faqs/)

## AWS Integration & Messaging

### SQS

- Standard Queue
  - 10 years old
  - Up to 10k msg/sec
  - Default retention 4 days, Up to 14 days
  - Low latency <10ms
  - Up to 256KB per message
- Delay Queue
  - Default delay 0*, Up to 15 minutes
  - Use __DelaySeconds__ Message Timer to overwrite queue configuration
- Message
  - Body
    - String up to 256KB
    - Metadata [Key-Value]
  - Return
    - Message identifier
    - MD5 hash
- Consumers
  - Receive up to 10 message at a time
  - Process the message within the visibility timeout
  - Delete the message using ID & receipt handle (DeleteMessage)
- Visibility Timeout
  - Default 30sec*, Min 0sec, Up to 12 hours
  - Use __ChangeMessageVisibility__ to overwirte queue configuration
- Dead Letter Queue (DLQ)
  - Redrive Policy: Send to a DLQ when visibility timeout has exceeded a threshold
- Long Polling
  - From 1 to 20* seconds
  - Use __WaitTimeSeconds__ to overwrite queue configuration
- FIFO Queue
  - Queue names must end with .fifo
  - Messages are processed in order and only once
  - Not available in all regions
  - Lower throughput 3k/sec with batching, 300/s without
  - No per message delay (only per queue)
  - De-duplication interval 5 min
  - Message GroupID allows to group. Extra tag
  - Only one worker per group
  - Must be defined at queue creation
- Advance Concepts
  - Cost Allocation Tags
  - SQS Extended Client
    - Allows to send large messages
    - Use S3 to store messages
  - Security
    - HTTPS for in flight
    - SSE
      - Can set CMK
      - Can set the data key reuse period. From 1 min up to 24 hours
        - Lower KMS API call, less secure, less expensive
      - Only encrypts the body, not the metadata
      - IAM controls usages of SQS
      - SQS queue access policy
        - Finer grained
      - No VPC Endpoint, must use internet to access SQS
  - API Calls
    - CreateQueue | DeleteQueue
    - PurgeQueue
    - SendMessage | ReceiveMessage | DeleteMessage
    - ChangeMessageVisibility
  - Batch APIs
    - SendMessage | DeleteMessage | ChangeMessageVisibility
  - Support Java Message Service (JMS)
- [FAQ](https://aws.amazon.com/sqs/faqs/)

### SNS

- Producer sends one message to the topic with attributes (metadata)
- Up to 10 million subscribers per topic
- 100k topics
- Add Filter Policy to avoid some messages
- Fan Out
  - Push to one SNS, receive in many SQS
- [FAQ](https://aws.amazon.com/sns/faqs/)

### AWS Kinesis

- Alternative to Apache Kafka
- Big Data streaming tools
- Real-Time big data
- Automatically replicated to 3 AZ
- Kinesis Streams
  - Low latency ingest
- Kinesis Data Analytics
  - Real-time analytics using SQL
- Kinesis Firehose
  - Load streams into S3, Readshift, ElasticSearch, Splunk
  - Near real-time (60ms)
  - Pay for the conversion and amount of data
  - Can invoke lambda to transform info before storing
- Stream are divided in ordered Shards / Partitions
- Default retention 1 day, Up to 7 days
- Ability to reprocess / replay data (go back in time)
- Multiple application can consume same streams
- Once data is inserted, it can't be deleted
- Shards
  - 1MB/s or 1k messages/s at write per shard
  - 2MB/s at read per shard, message propagation delay 70 ms for all consumers
  - Billed per shard
  - Batching available
  - Records are ordered only per shard
  - Number of shards can change (reshard / merge)
  - number_of_shards = max(incoming_write_bandwidth_in_KiB/1024, outgoing_read_bandwidth_in_KiB/2048)
- Put Records
  - __PutRecord__ API + Partition Key
  - Same key goes to same partition
  - Random key to prevent hot partition
  - __PutRecords__ for Bash
  - If got error __ProvisionedThroughputExceeded__ when limits exceded, limit the requests
- Consumers
  - Normal consumer: CLI, SDK, etc
  - Kinesis Client Library (Java, Node, Python, Ruby, .NET)
    - Uses DynamoDB to checkpoint offsets
    - Uses DynamoDB to track other workers and share work among shards
- Security
  - Encrytion at rest is available using KMS
  - VPC endpoints available
- [FAQ](https://aws.amazon.com/kinesis/data-streams/faqs/)

## AWS Lambda

- Virtual functions
- Limited by time
- Run on-demand
- Run on-schedule using Cloudwatch events
- Scaling is automated
- Pay per request and compute time. See [Pricing](https://aws.amazon.com/lambda/pricing/?nc1=h_ls)
- Free Tier: 1 million and 400.000 GB seconds of compute time
- Easy monitoring with CloudWatch Logs (integrated with debug statements)
- Easy to get more resources per function
- Integrated with CloudWatch and CloudTrail
- Support: Node.js, Python, Java, C#, Goland, .NET
- Configuration
  - Timeout
  - Environment variables
  - Allocated memory
  - Ability to deploy in a VPC
  - Must have a role
- Concurrency
  - Can be set a limit using "Reserve concurrency"
  - Each extra invocation trigger a __Throttle__
    - syncrhonous invocation: return __ThrottleError__ - 429
    - asyncrhonous invocation: retry automatically twice and then go to DLQ
- DLQ
  - Used to debug asynchronous functions
  - SNS topic or SQS queue
- Limits
  - Time: Default 3 sec, up to 900 sec (15 min)
  - Memory: 128M to 3G (3008MB) - 64MB increments
  - Disk: 512MB in /tmp
  - Concurrency: 1k
  - Code: 50MB .zip
  - Code: 250MB uncompressed
  - Env Variables: 4KB
- Versions
  - Code + Configuration
  - Versions are inmutable
  - A unique ARN is assigned
  - $LATEST: Current
- Aliases
  - Pointers to Lambda versions
  - Mutable
  - Enable weight traffic to new versions (Create and Update -routing-config paramater)
- Lambda@Edge use to customize CloudFront content
- If requires access to VPC resources, the SubnetID and Security Group ID must be mentioned
- Routing (5%)
  - aws lambda update-alias --name alias name --function-name function-name \
    --routing-config AdditionalVersionWeights={"2"=0.05}
- Parts
  - FunctionName
  - Layers
  - Handler
- Best practices
  - Heavy-duty outside function handler
    - Connection to DB
    - Initialize AWS SDK (reuse Execution Context)
    - Pull it dependencies
  - Environment variables
    - Connections strings, S3 buckets
    - Sensitive values must be encrypted
  - Minimize deployment package
    - For Java or .NET select only the required libraries
  - Don't use recursive code
  - Don't put in a VPC unless needed
  - Easy integration with SQS
- [FAQ](https://aws.amazon.com/lambda/faqs/)

## DynamoDB

- Fully managed NoSQL Serverless Database
- Scales horizontally
- All data is present in one row
- High available with replication across 3 AZ
- Support millions of requests/sec and TB storage
- Low latency
- Enable event driver programming with DynamoDB Streams
- Support TTL for Item to reduce storage usage
- Ideal to store JSON information
- Tables
  - Primary Key (decided at time creation)
  - Tables can have infinite items (rows)
  - Items has attributes (can be added over time)
  - Maximum item size is 400KB
  - Data types
    - Scalar: String, Number, Binary, Boolean, Null
    - Document: List, Map
    - Set: String, Number, Binary
- Primary Key
  - Option 1: Partition Key (Use to distribute data). Similar to SQL tables
  - Option 2: Partition Key [HASH] + Sort Key (Combination must be unique) [RANGE]
- Provisioned Throughput (Capacity Units)
  - Can be exceeded using "burst credit"
  - If "burst credit" is empty, you'll get error __ProvisionedThroughputException__
  - It's advised to do exponential back-off retry
  - WCU: Write
    - 1 WCU is equivalent to
      - 1 write/sec
      - Item of 1 KB
    - Formula = (write/WCU=[1])/sec * (Size/1KB)
    - It needs to round size (up) to a multiple of 1KB
    - WCU*(Size)*(factor)
  - RCU: Read
    - 1 RCU is equivalent to
      - 1 read/sec (strongly consistent)
      - 2 read/sec (eventually consistent)
      - Item size 4KB
    - Formula = (read/RCU=[1,2])/sec * (Size/4KB)
    - It needs to round size (up) to a multiple of 4KB
    - RCU*(Size)*(factor)
- Data is divided in partitions
  - Number of partitions
    - By Capacity: (TOTAL RCU / 3000) + (Total WCU / 1000)
    - By Size: (TOTAL SIZE / 10 GB)
    - Total partitions: CEILING(MAX(Capacity, Size))
  - WCU/RCU are spread evenly between partitions
- Throttling
  - If RCU-WCU are exceeded, you'll get error ____ProvisionedThroughputExceededException__
  - It happens as a result of: Hot keys, Hot partitions, Very large items
  - Solutions
    - Exponential back-off
    - Distribute partitions
    - If RCU issue, use DynamoDB Accelerator (DAX)
- API
  - PutItem
  - UpdateItem
    - Conditional Writes: Only if conditions are respected
  - GetItem
    - Option to use strongly consistent
    - __ProjectionExpression__ can be used to obtain only certain attributes
  - DeleteItem
    - Individual row
    - Conditional delete
  - DeleteTable
  - BatchWriteItem
    - Up to 25 PutItem / DeleteItem
    - Up to 16MB
    - Operations are done in parallel
    - Up to user to retry failed updates
  - BathGetItem
    - Up to 100 items
    - Up to 16 MB
  - Query
    - Return item based on Partition + SortKey
    - __FilterExpression__ can be used on client side
    - Return Up to 1MB
    - Number of items specified in __Limit__
    - Key Condition Expression = Partition Key + Value in equality condition
  - Scan (inefficient)
    - Read entire table
    - Return Up to 1MB
    - Consume a lot of RCU
    - Number of items specified in __Limit__
    - Parallel scan to faster performance
    - Can use __ProjectionExpression__ + __FilterExpression__
- Return RCU for Scan/Query
  - NONE: Default
  - TOTAL: RCU consumed
  - INDEXES: RCU consumed for each table and index accessed
- Indexes
  - Local Secondary Index (LSI)
    - Alternative range key
    - Up to 5 per table
    - One scalar attribute
    - Must be defined at table creation
    - Its hash key is the same as the hash key of main table
  - Global Secondary Index (GSI)
    - Speed queries on non-key attributes
    - Partition key + Optional Sort key
    - Index is a new "table", we can project attributes
      - KEYS_ONLY
      - INCLUDE
      - ALL
    - Must define RCU/WCU for index
    - Possibility to add/modify GSI (not LSI)
    - Allow query entire table, across all partitions
    - Not support Consistent Read
- Concurrency
  - Optimistic locking / concurrency database
- DAX
  - Cache, all writes go through DAX
  - Solves the Hot Key problem (too many reads)
  - 5 minutes TTL for cache
  - Up to 10 nodes in the cluster
  - Multi AZ
  - For eventual consistent read, it tries to get item from cache
  - For strong consistent read, it passes the request to DynamoDB and avoid caching
  - Item Cache
    - stored GetItem and BatchGetItem operations
  - Query Cache
    - stored for Query and Scan operations
- DB Streams
  - Changelog ends up in a stream
  - Stream can be read by AWS Lambda to:
    - React in real time
    - Analytics
    - Create derivative tables /views
    - Insert into ElasticSearch
  - Use to implement cross region replication
  - 24 hours retention
- Security
  - VPC Endpoints available
  - Controlled by IAM
  - Using IAM: a table item or attributes can be hidden
  - Encryption at rest using KMS (defined at table creation)
  - Encryption in transit using SSL / TLS
  - Uses Tables Keys with AWS owned CMK (free) or AWS Managed CMK (chargeable)
- Backups and Restore features
  - No performance impact
  - Point in time restore like RDS
- Global Tables
  - Multi region, fully replicated, high performance
- Amazon DMS to migrate to DynamoDB
- A local DynamoDB can be launch in the computer for testing
- Decrease pagesize to reduce throttling
- [FAQ](https://aws.amazon.com/dynamodb/faqs/)

## API Gateway

- Handle API versioning
- Handle different environments
- Handle security (AA)
- Handle throttling
- Can deny access using WAF / Resource Policies
- Create API keys
- Integration with Swagger / Open API to import APIs
- Transform/Validate requests/responses
- Cache API responses
- Changes must be deployed to "Stages"
- Use Binary Payloads for non-text request/response
- Proxys
  - "type":"aws_proxy" redirect to Lambda
  - "type":"http_proxy" redirect to backend HTTP endpoints
- To Modify behavior of:
  - Front-End edit the Method request/response, eg: XML<=>JSON
  - Back-End edit Integration request/response, eg: Databases
- Stages
  - Environments
  - Variables
    - Similar to env vars to change configuration
    - Are passed to the __context__ of Lambda
    - Use Case: point to different Lambda Alias
    - Passed as
      - A full URI without protocol = http: //$stageVariables.< variable_name >
      - A full domain = http ://$stageVariables.< variable_name >/resource/operation
      - A subdomain = http ://$stageVariables.< variable_name >.example.com/resource/operation
      - A path = http ://example.com/$stageVariables.< variable_name >/bar
      - A query string = http ://example.com/foo?q=$stageVariables.< variable_name >
- URL
  - https://xxx.yyy/resource/stage (eg:. /chapters/dev)
- Canary Deployment
  - Choose % traffic
- Mapping Templates
  - Can modify body, parameters, request/responses
  - Can add headers
  - Can map JSON to XML
  - Use VTL language (Velocity Template Language)
- Swagger (Open API spec)
  - Define REST APIs as code
  - Import/Export
- API Caching
  - TTL from 0-300 sec. Default 300s
  - Can be encrypted
  - Storage from 0.5-237 GB
  - Can be defined per stage or per methods
  - Can flush entire cache
  - Client can invalidate with header __Cache-Control:max-age=0__ (proper IAM authorization)
- Monitoring (with proper IAM role)
  - CloudWatch Logs
    - Enable at Stage level
  - CloudWatch Metrics
    - Metric are by stage
  - X-Ray
- CORS
  - Cross Origin Resource Sharing
  - Enable calls from other domains
  - Manually return Access-Control-Allow-Origin to enable CORS on some method
  - OPTIONS pre-flight request must contain these headers
    - __Access-Control-Allow-Methods__
    - __Access-Control-Allow-Headers__
    - __Access-Control-Allow-Origin__
- Usage Plans
  - Limit customers
  - Throttling: Overall and burst capacity
  - Quotas: Number of request per day/week/month
  - Associated with API Stages
- API Keys
  - Per customer
  - Associate with plans
  - Track usage for API Keys (bill clients)
- Security
  - IAM Permissions
    - Sig v4: Authorize User/Rol to access API Gateway
    - API Keys
  - Lambda Authorizer (Custom Authorizer)
    - Use Lambda to validate token in header
    - Option to cache result of authentication
    - Pey per Lambda invocation
    - Help to use OAuth / SAML / 3rd party authentication
  - Cognito User Pools
    - Manage user lifecycle
    - Only help with authentication (not authorization)
- Errors
  - 40X: Request
  - 50X: Server & Network
- [FAQ](https://aws.amazon.com/api-gateway/faqs/)

## AWS Cognito

- Product Types
  - Cognito User Pools (CUP)
    - Sign-in functionality for app users
    - Integrated with API Gateway
    - Serverless database of users and profiles
    - Can enable Federated Identities (Facebook/Google/SAML)
    - Sends back a JSON Web Token (JWT)
    - Optional MFA available
    - Advanced Security = Block Use when credentials are compromised
  - Cognito Identity Pools (Federated Identity)
    - Provides AWS credentials to user to access AWS resources directly
    - Integrated with Cognito User Pools
    - Can use unauthenticated identities
    - Multiple rules are evaluated sequencial after first match, except when __CustomRoleArn__
  - Cognito Sync
    - Synchronize data from device to Cognito
    - Deprecated and replaced by AppSync
    - Requires Federates Identity Pool (not User Pool)
    - Store data in datasets (Up to 1MB)
    - Up to 20 dataset to synchronize
    - Cognito Streams
      - Kinesis stream to receive events
      - Control and insight data stored in Amazon Cognito
      - Use an existing or new Kinesis Stream and create a role to publish to Stream
    - Cognito Events
      - Allows execute Lambda functions in response to important events
      - Function UpdateRecords must respond in 5 sec, if not LambdaSocketTimeoutException
      - Try retry sync if you get a LambdaThrottledException
- [FAQ](https://aws.amazon.com/cognito/faqs/)

## SAM (Serverless Application Model)

- Framework for developing and deploying SAM
- Config are YAML files
- Support CloudFormation components
- Lambda Code must be in root directory along with YAML file
- Upload Code to an S3 bucket
- Deployment Patterns
  - Canary10Percent5Minutes (Initial 10%, the rest after 5 min)
  - Linear10PercentEvery1Minute
  - AllAtOnce
- YAML
  - Header: Transform: 'AWS::Serverless-2016-10-31'
  - Helpers:
    - 'AWS::Serverless::Function' (Lambda)
    - 'AWS::Serverless::LayerVersion' (Lambda Layered)
    - 'AWS::Serverless::Api' (API Gateway)
    - 'AWS::Serverless::SimpleTable' (DynamoDB)
    - 'AWS::Serverless::Application' (S3)
  - Package & Deploy
    - aws cloudformation package / sam package
    - aws cloudformation deploy / sam deploy
- [SAM Examples](https://github.com/awslabs/serverless-application-model/tree/master/examples/apps)
- [FAQ](https://aws.amazon.com/serverless/sam/faqs/)

## AWS Security

- Encryption in flight
- Encryption at rest
  - SSE
  - CSE
- KMS
  - Fully integrated with IAM
  - Encryption process
    - GenerateDataKey to get the Plaintext key
      - Result: KeyId, CiphertextBlob, Plaintext
    - GenerateDataKeyWithoutPlaintext to get key
      - Result: KeyId, CiphertextBlob
    - Encrypt using the Plaintext key
    - Delete Plaintext key from memory
  - KMS can only encrypt 4KB of data per call
  - If data > 4KB use envelope encryption
  - Envelop
    - Data is encrypted using a plaintext Data Key
    - Data Key is encrypted using a plaintext Master Key
  - Create/Rotate/Disable/Enable
  - Types of CMK
    - AWS Managed Service Default CMK: free
    - User Keys created in KMS: $1/month
    - User Keys imported (256-bit symetic key): $1/month
  - Pay for API call to KMS ($0.03/1k calls)
  - API
    - Encrypt
    - Decrypt

- Encryption SDK
  - Helps to use Envelope Encryption
  - Different from S3 Encryption SDK
  - Exists as a CLI tool
  - API Call: GenerateDataKey API

- AWS Parameter Store (SSM)
  - Also called Simple Systems Manager
  - Alternative to AWS Secrets Manager with cost
  - Secure storage for configuration and secrets
  - Free
  - Version tracking
  - Integrated with IAM
  - Notification with CloudWatch Events
  - Integration with CloudFormation
  - Organized by Hierarchy
  - aws ssm get-paramaters --with-decription

- STS
  - Security Token Service
  - API's: AssumeRole, AssumeRoleWithWebIdentity, AssumeRoleWithSAML
  - Temporary credentials [15m - 1h]
  - Uses Tokens not Access Keys
  - Use mainly for Users. For application use Access-Keys
  - Use CLI sts decode-authorization-message to decode errors

- Policies
  - [Policy Generator](https://awspolicygen.s3.amazonaws.com/policygen.html)
  - [Simulator](https://policysim.aws.amazon.com/home/index.jsp?#)
  - Supports Policy versioning
  - CLI Simulator
    - Get context keys
    - Use aws iam simulate-custom-policy

## Other AWS Services

### AWS CloudFront

- Content Delivery Network (CDN)
- Use with front-end tier
- Improve read performance
- Around 136 Point of Presence (edge location)
- Support RTMP Protocol
- [FAQ](https://aws.amazon.com/cloudfront/faqs/)

### AWS Step Functions

- Build serverless visual workflows to orchestrate Lambda functions / microservices
- Represent flow as JSON state machine
- Features: sequence, parallel, conditions, timeouts, error handling
- Use Lambda Retry code with ErrorEquals for handling ServiceException
- Can also integrate with EC2, API Gateway
- Maximum execution time: 1 year
- [FAQ](https://aws.amazon.com/step-functions/faqs/)

### AWS Simple Workflow Service (SWF)

- Coordinate work amongst applications
- Code run on EC2 (not serverless)
- Older than Step Functions
- Used over Step Functions only if external signals or child processes are needed
- States can have multiple transitions
- Best Practices
  - Use S3 when the payloads are over 32KB
  - Include a timeout in each state machine definition
  - Avoid reaching history limit
- [FAQ](https://aws.amazon.com/swf/faqs/)

### AWS ECS (Elastic Container Service)

- Help to run/orchestrate Docker containers on EC2 machines
- Components
  - ECS Core: Running ECS on EC2 instances
  - Fargate: Running ECS tasks (serverless)
  - EKS: Running ECS on Kubernetes (EC2)
  - ECR: Docker Container Registry
- Supports Docker Hub
- IAM and roles at the ECS task level
- Security Groups and ACL's controls traffic
- Use Cases: microservices, batch processing, migrate apps
- If ECS is stopped, container instance is Active but Agent connection is false
- Concepts
  - ECS Cluster
  - ECS Service
  - ECS Tasks + Definition
  - ECS IAM roles
- ALB (App Load Balancer) integration
  - Use Dynamic Port Mapping
  - Support WebSocket and HTTP/2
- Setup
  - EC2 Instance
  - Install
    - ECS agent
    - Config file
      - /etc/ecs/ecs.config
        - __ECS_CLUSTER__: Assign EC2 to ECS cluster
        - __ECS_ENGINE_AUTH_DATA__: Pull images from private registries
        - __ECS_AVAILABLE_LOGGING_DRIVERS__: CloudWatch container loggin
        - __ECS_ENABLE_TASK_IAM_ROLE__: Enable IAM roles for ECS tasks
- [FAQ](https://aws.amazon.com/ecs/faqs/)

### AWS Databases

- RDS: OLTP
  - PostgreSQL, MySQL, Oracle, Aurora
- DynamoDB: NoSQL
- ElasticCache
  - In memory DB
  - Perfect solution for storing User Sessions
  - Multiple AZ's
  - Strategies
    - Lazy Loading: After a cache missed, app writes data to the cache
    - Write Through: After every change in data, the cache is also updated
    - Adding TTL: Add a TTL in the cache
  - Memcached
    - Multithreaded performance
    - Simple data types
  - Redis
    - Advance data structures
    - Leaderboards
    - Multiple Replicas - High Availability
    - Snapshots
    - Pub/Sub capability
- Redshift: OLAP
  - Analytic
  - Data Warehousing / Data Lake
  - Use COPY to transfer large data from S3/DynamoDB
  - Support enabling encryption after the cluster is created
- Neptune: Graph DB
- DMS: Database Migration Service

### AWS CodeStart

- Manage full cycle of project
- Develop, Build, Deploy
- [FAQ](https://aws.amazon.com/codestar/faqs/)

### AWS QuickSight

- BI analytics to build visualizations, perform analysis and get insights

### AWS Config

- Analize, audit and evaluate AWS configurations
